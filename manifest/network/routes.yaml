# oauth route
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: lil-oauth-httproute
  namespace: lil-network
spec:
  parentRefs:
  - name: default-gateway
    kind: Gateway
  hostnames:
  - oauth.lilamaris.kr
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /public
    backendRefs:
      - name: oauth2-proxy-public
        port: 4180
  - matches:
    - path:
        type: PathPrefix
        value: /private
    backendRefs:
      - name: oauth2-proxy-private
        port: 4180

---

# Admin service route
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: lil-admin-httproute
  namespace: lil-admin
spec:
  parentRefs:
  - name: default-gateway
    kind: Gateway
    namespace: lil-network
  hostnames:
  - admin.lilamaris.kr
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /monitor
    backendRefs:
      - name: oauth2-proxy-private
        namespace: lil-network
        port: 4180

---

# ReferenceGrant by lil-network
apiVersion: gateway.networking.k8s.io/v1beta1
kind: ReferenceGrant
metadata:
  name: reference-grant-from-lil-network-to-lil-admin
  namespace: lil-network
spec:
  from:
  - group: gateway.networking.k8s.io
    kind: HTTPRoute
    namespace: lil-admin
  to:
  - group: ""
    kind: Service

---

# ReferenceGrant by lil-monitor
apiVersion: gateway.networking.k8s.io/v1beta1
kind: ReferenceGrant
metadata:
  name: reference-grant-from-lil-dashboard-to-lil-admin
  namespace: lil-monitor
spec:
  from:
  - group: gateway.networking.k8s.io
    kind: HTTPRoute
    namespace: lil-admin
  to:
  - group: ""
    kind: Service

---
